<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benimle Evlenir Misin?</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <div class="background-overlay"></div>

    <div class="container" id="mainCard">
        <div class="card">
            <div class="content">
                <div class="ring-animation">
                    <img src="https://pngimg.com/uploads/ring/ring_PNG26.png" alt="TektaÅŸ YÃ¼zÃ¼k" class="ring-img">
                </div>
                
                <h1 class="title" id="mainTitle">YÃ¼kleniyor...</h1>
                <p class="subtitle">Ã–mrÃ¼mÃ¼n geri kalanÄ± olur musun?</p>
            </div>
            
            <div class="buttons">
                <button class="btnYes" id="yesButton">EVET ğŸ’</button>
                <button class="btnNo" id="noButton">HAYIR ğŸ’”</button>
            </div>
        </div>
    </div> 

    <div class="gallery-container" style="display: none;">
        <div class="box">
            <div class="dream" id="photoGallery">
                </div>
        </div>
    </div>
        
    <footer>
        <a href="https://www.instagram.com/soncaybektas/" target="_blank">
            <i class="fab fa-instagram"></i> Instagram
        </a>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuKzZVAA3K3dtlzxSmIc4h07CyqXMBk5Y",
            authDomain: "lovespage61.firebaseapp.com",
            projectId: "lovespage61",
            storageBucket: "lovespage61.firebasestorage.app",
            messagingSenderId: "954368938690",
            appId: "1:954368938690:web:b6880d8524570e6e06a15b",
            measurementId: "G-DR224E42S8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Verileri Ã‡ekme Fonksiyonu ---
        async function loadSiteData() {
            // URL'den ?id=XYZ kÄ±smÄ±nÄ± al
            const urlParams = new URLSearchParams(window.location.search);
            const docId = urlParams.get('id');

            // VarsayÄ±lan veriler (EÄŸer ID yoksa bunlar gÃ¶rÃ¼nsÃ¼n)
            let data = {
                partnerName: "Prenses",
                proposalMessage: "Sonsuza kadar EVET! ğŸ’",
                musicUrl: "ses/sess.mp3", // KlasÃ¶rdeki yedek mÃ¼zik
                images: ["fotolar/1.jpg", "fotolar/2.jpg", "fotolar/3.jpg", "fotolar/4.jpg", "fotolar/5.jpg", "fotolar/6.jpg", "fotolar/7.jpg", "fotolar/8.jpg"]
            };

            if (docId) {
                try {
                    const docRef = doc(db, "proposals", docId);
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        data = docSnap.data();
                        console.log("Veri Ã§ekildi:", data);
                    } else {
                        console.log("BÃ¶yle bir kayÄ±t bulunamadÄ±!");
                    }
                } catch (error) {
                    console.error("Hata:", error);
                }
            }

            // 1. Ä°smi GÃ¼ncelle
            document.getElementById('mainTitle').innerText = `Benimle Evlenir Misin ${data.partnerName}?`;

            // 2. Galeriyi Doldur
            const gallery = document.getElementById('photoGallery');
            gallery.innerHTML = ''; // Temizle
            data.images.forEach((imgUrl, index) => {
                // Sadece 8 tane koyalÄ±m
                if(index < 8) {
                    const span = document.createElement('span');
                    span.style.setProperty('--i', index + 1);
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    span.appendChild(img);
                    gallery.appendChild(span);
                }
            });

            // 3. MÃ¼zik ve Buton MantÄ±ÄŸÄ±nÄ± BaÅŸlat
            initLogic(data);
        }

        // --- Buton ve Animasyon MantÄ±ÄŸÄ± ---
        function initLogic(data) {
            const yesButton = document.getElementById('yesButton');
            const noButton = document.getElementById('noButton');
            const card = document.querySelector('.card'); 
            const mainContainer = document.getElementById('mainCard');
            const title = document.querySelector('.title');
            
            // Kart AyarÄ±
            if(card) { card.style.position = "relative"; card.style.overflow = "hidden"; }

            let isYesClicked = false;
            let escapeCount = 0; 
            const maxEscapes = 5; 

            // EVET TIKLAMA
            yesButton.addEventListener('click', function () {
                if (!isYesClicked) {
                    isYesClicked = true;
                    
                    // VeritabanÄ±ndan gelen mÃ¼ziÄŸi Ã§al
                    const audio = new Audio(data.musicUrl);
                    audio.volume = 0.5; 
                    audio.play().catch(e => console.log("Ses hatasÄ± (tÄ±klama gerekir):", e));

                    startConfetti();

                    // VeritabanÄ±ndan gelen mesajÄ± yaz
                    title.innerText = data.proposalMessage;
                    document.querySelector('.subtitle').textContent = 'Seni dÃ¼nyanÄ±n en mutlu insanÄ± yapacaÄŸÄ±m...';
                    
                    document.querySelector('.buttons').style.display = 'none';
                    if(noButton) noButton.style.display = 'none'; 

                    // Galeriye GeÃ§
                    setTimeout(() => {
                        mainContainer.style.opacity = "0";
                        const galleryCont = document.querySelector('.gallery-container');
                        galleryCont.style.display = 'flex'; 
                        setTimeout(() => {
                            galleryCont.style.opacity = "1";
                            mainContainer.style.display = "none"; 
                        }, 500);
                    }, 3000); 
                }
            });

            // HAYIR KAÃ‡MA (DeÄŸiÅŸmedi)
            function moveButton() {
                escapeCount++; 
                if (escapeCount >= maxEscapes) {
                    noButton.style.opacity = "0";
                    noButton.style.transform = "scale(0)";
                    setTimeout(() => { noButton.style.display = 'none'; }, 500);
                    title.innerText = "Naz yapma prenses, takacaÄŸÄ±m o yÃ¼zÃ¼ÄŸÃ¼ ğŸ˜‰";
                    return; 
                }
                if (noButton.parentElement !== card) card.appendChild(noButton);
                
                const padding = 40; 
                const cardRect = card.getBoundingClientRect();
                const maxWidth = cardRect.width - noButton.offsetWidth - padding;
                const maxHeight = cardRect.height - noButton.offsetHeight - padding;
                const randomX = Math.max(padding, Math.random() * maxWidth);
                const randomY = Math.max(padding, Math.random() * maxHeight);

                noButton.style.position = 'absolute'; 
                noButton.style.left = randomX + 'px';
                noButton.style.top = randomY + 'px';
            }

            noButton.addEventListener('mouseover', moveButton);
            noButton.addEventListener('click', (e) => { e.preventDefault(); moveButton(); });
            noButton.addEventListener('touchstart', (e) => { e.preventDefault(); moveButton(); });
        }

        // KALP KONFETÄ°
        function startConfetti() {
            for(let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.classList.add('heart');
                    heart.innerHTML = 'ğŸ’'; 
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.fontSize = Math.random() * 20 + 20 + 'px'; 
                    heart.style.animationDuration = Math.random() * 2 + 3 + 's';
                    document.body.appendChild(heart);
                    setTimeout(() => { heart.remove(); }, 5000);
                }, i * 100); 
            }
        }

        // Sayfa aÃ§Ä±lÄ±nca verileri yÃ¼kle
        window.addEventListener('DOMContentLoaded', loadSiteData);
    </script>
</body>
</html>