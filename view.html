<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√ºrpriz!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div id="startOverlay">
        <button class="start-btn" id="startBtn">Dokun ve Ba≈üla ‚ù§Ô∏è</button>
    </div>

    <div class="background-overlay"></div>

    <div class="container" id="mainCard">
        <div class="card" data-aos="zoom-in" data-aos-duration="1200">
            <div class="content">
                <div id="iconWrapper" class="ring-animation" data-aos="fade-down" data-aos-delay="400"></div>
                
                <h1 class="title" id="mainTitle"></h1>
                <p class="subtitle" id="mainSubtitle"></p>
            </div>
            
            <div class="buttons" id="btnGroup">
                <button class="btnYes" id="yesButton">EVET</button>
                <button class="btnNo" id="noButton">HAYIR</button>
            </div>
        </div>
    </div> 

    <div class="gallery-container" id="galleryLayer" style="display: none;">
        <div class="box">
            <div class="dream" id="photoGallery"></div>
        </div>
    </div>
    
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        AOS.init({ duration: 1000, once: true });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCuKzZVAA3K3dtlzxSmIc4h07CyqXMBk5Y", 
            authDomain: "lovespage61.firebaseapp.com", 
            projectId: "lovespage61", 
            storageBucket: "lovespage61.firebasestorage.app", 
            messagingSenderId: "954368938690", 
            appId: "1:954368938690:web:b6880d8524570e6e06a15b", 
            measurementId: "G-DR224E42S8" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DAKTƒ∞LO EFEKTƒ∞ FONKSƒ∞YONU ---
        function typeWriter(elementId, text, speed, callback) {
            let i = 0;
            const element = document.getElementById(elementId);
            element.innerHTML = "";
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    if (callback) callback();
                }
            }
            type();
        }

        async function loadSiteData() {
            const urlParams = new URLSearchParams(window.location.search);
            const docId = urlParams.get('id');
            
            // Varsayƒ±lan Veriler (Veritabanƒ± yoksa bunlar g√∂r√ºn√ºr)
            let data = {
                partnerName: "Sevgilim",
                proposalMessage: "Sonsuza kadar EVET! üíç",
                theme: "love", // 'love' veya 'birthday'
                musicUrl: "", 
                images: Array(8).fill("https://via.placeholder.com/600")
            };

            if (docId) {
                try {
                    const docSnap = await getDoc(doc(db, "proposals", docId));
                    if (docSnap.exists()) {
                        data = docSnap.data();
                    }
                } catch (error) { console.error("Veri √ßekme hatasƒ±:", error); }
            }

            // --- TEMA VE ƒ∞√áERƒ∞K AYARLARI ---
            const isBirthday = data.theme === 'birthday';

            // ƒ∞kon Se√ßimi (Pasta veya Y√ºz√ºk)
            const iconHtml = isBirthday ? 
                `<div class="cake-wrapper">
                    <div class="flame"></div>
                    <img src="https://i.ibb.co/2Z7fVfM/cake-icon.png" class="cake-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2682/2682431.png'">
                </div>` : 
                `<img src="https://pngimg.com/uploads/ring/ring_PNG26.png" class="ring-img">`;
            
            document.getElementById('iconWrapper').innerHTML = iconHtml;

            // Galeri Fotoƒüraflarƒ±nƒ± Y√ºkle
            const gallery = document.getElementById('photoGallery');
            // Eƒüer resim sayƒ±sƒ± 8'den azsa placeholder ile tamamla
            const imagesToLoad = data.images && data.images.length > 0 ? data.images : Array(8).fill("https://picsum.photos/400/600");
            
            imagesToLoad.forEach((imgUrl, index) => {
                if(index < 8) {
                    const span = document.createElement('span');
                    span.style.setProperty('--i', index + 1);
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    span.appendChild(img);
                    gallery.appendChild(span);
                }
            });

            // Buton Metinleri
            document.getElementById('yesButton').innerHTML = isBirthday ? "KUTLA üéâ" : "EVET üíç";
            document.getElementById('noButton').innerHTML = isBirthday ? "HAYIR üéÇ" : "HAYIR üíî";

            // --- Gƒ∞Rƒ∞≈û PERDESƒ∞ VE M√úZƒ∞K ---
            document.getElementById('startBtn').addEventListener('click', () => {
                // M√ºziƒüi Ba≈ülat
                if (data.musicUrl) {
                    const audio = new Audio(data.musicUrl);
                    audio.volume = 0.6;
                    audio.play().catch(e => console.log("Ses √ßalma hatasƒ±:", e));
                }

                // Perdeyi Kaldƒ±r
                const overlay = document.getElementById('startOverlay');
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 1000);

                // Daktilo Efekti Ba≈ülasƒ±n
                const titleText = isBirthday ? `ƒ∞yi Ki Doƒüdun ${data.partnerName}!` : `Benimle Evlenir Misin ${data.partnerName}?`;
                const subText = isBirthday ? "Nice mutlu ya≈ülara..." : "√ñmr√ºm√ºn geri kalanƒ± olur musun?";

                typeWriter("mainTitle", titleText, 90, () => {
                    typeWriter("mainSubtitle", subText, 50, () => {
                        // Yazƒ±lar bitince butonlar g√∂r√ºns√ºn
                        document.getElementById('btnGroup').style.opacity = '1';
                    });
                });
            });

            initLogic(data, isBirthday);
        }

        function initLogic(data, isBirthday) {
            const yesButton = document.getElementById('yesButton');
            const noButton = document.getElementById('noButton');
            const card = document.querySelector('.card'); 
            const mainContainer = document.getElementById('mainCard');
            const title = document.querySelector('.title');
            
            let isYesClicked = false;
            let escapeCount = 0; 

            // Troll Hayƒ±r Butonu S√∂zleri
            const noTexts = isBirthday ? 
                ["Emin misin?", "Pasta eridi!", "Yapma be!", "Hadi √ºfle!", "Tamam pes :)"] : 
                ["Emin misin?", "Bir daha d√º≈ü√ºn?", "Son kararƒ±n mƒ±?", "Kƒ±rma kalbimi...", "Basamazsƒ±n ki :)"];

            // --- EVET BUTONU ---
            yesButton.addEventListener('click', function () {
                if (!isYesClicked) {
                    isYesClicked = true;
                    
                    // Havai Fi≈üek / Konfeti
                    startConfetti(isBirthday ? 'üéâ' : '‚ù§Ô∏è');
                    
                    title.innerText = data.proposalMessage;
                    document.getElementById('mainSubtitle').innerText = isBirthday ? "ƒ∞yi ki varsƒ±n!" : 'Seni d√ºnyanƒ±n en mutlu insanƒ± yapacaƒüƒ±m...';
                    document.getElementById('btnGroup').style.display = 'none';
                    
                    setTimeout(() => {
                        mainContainer.style.opacity = "0";
                        const galleryCont = document.getElementById('galleryLayer');
                        galleryCont.style.display = 'flex'; 
                        setTimeout(() => { 
                            galleryCont.style.opacity = "1"; 
                            mainContainer.style.display = "none"; 
                        }, 500);
                    }, 3000); 
                }
            });

            // --- HAYIR BUTONU KA√áIRMA ---
            function moveButton() {
                if (escapeCount < 5) {
                    // Yazƒ±yƒ± deƒüi≈ütir
                    noButton.innerText = noTexts[escapeCount];
                    
                    const rect = card.getBoundingClientRect();
                    // Rastgele koordinat (Kartƒ±n dƒ±≈üƒ±na √ßƒ±kmasƒ±n diye sƒ±nƒ±rlandƒ±)
                    const x = Math.max(10, Math.random() * (rect.width - 120));
                    const y = Math.max(10, Math.random() * (rect.height - 50));
                    
                    noButton.style.position = 'absolute'; 
                    noButton.style.left = x + 'px'; 
                    noButton.style.top = y + 'px';
                    
                    escapeCount++; 
                } else {
                    noButton.style.display = 'none'; 
                    title.innerText = isBirthday ? "Pastayƒ± √ºfle artƒ±k! üéÇ" : "Naz yapma prenses! üòâ"; 
                }
            }

            noButton.addEventListener('mouseover', moveButton);
            noButton.addEventListener('touchstart', (e) => { e.preventDefault(); moveButton(); });
        }

        function startConfetti(emoji) { 
            for(let i=0; i<80; i++) {
                setTimeout(() => { 
                    const h = document.createElement('div'); 
                    h.className='heart'; 
                    h.innerHTML= Math.random() > 0.5 ? emoji : '‚ú®'; 
                    h.style.left = Math.random() * 100 + 'vw';
                    const duration = Math.random() * 3 + 2; 
                    h.style.animationDuration = duration + 's';
                    h.style.fontSize = Math.random() * 20 + 20 + 'px';
                    document.body.appendChild(h); 
                    setTimeout(() => h.remove(), duration * 1000);
                }, i * 80); 
            } 
        }

        window.addEventListener('DOMContentLoaded', loadSiteData);
    </script>
</body>
</html>
